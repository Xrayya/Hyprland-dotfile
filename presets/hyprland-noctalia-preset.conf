# Hyprland Configuration
# https://wiki.hypr.land/Configuring/

# ==================
# MONITOR CONFIG
# ==================
# monitor = eDP-2, 2560x1600@239.998993, 2560x0, 1, vrr, 1
monitor = eDP-1, 2880x1800@90.001, 0x0, 1.8, bitdepth, 10, cm, dcip3

# ==================
# ESSENTIAL ENV
# ==================
# ############ Wayland #############
env = ELECTRON_OZONE_PLATFORM_HINT,auto

######### Applications #########
env = XDG_DATA_DIRS,$HOME/.local/share/flatpak/exports/share:/var/lib/flatpak/exports/share:/usr/local/share:/usr/share

env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland

# ############ Themes #############
env = QT_QPA_PLATFORM, wayland;xcb
env = QT_QPA_PLATFORMTHEME, qt6ct
env = GTK_USE_PORTAL=1
env = XDG_MENU_PREFIX, plasma-

env = TERM,kitty -1
env = CHROME_EXECUTABLE, google-chrome-stable

env = XCURSOR_THEME,Bibata-Modern-Classic
env = XCURSOR_SIZE,20
env = HYPRCURSOR_THEME,Bibata-Modern-Classic
env = HYPRCURSOR_SIZE,20

# ==================
# STARTUP APPS
# ==================
exec-once = dbus-update-activation-environment --systemd --all
exec-once = systemctl --user import-environment QT_QPA_PLATFORMTHEME
exec-once = /usr/lib/polkit-kde-authentication-agent-1
exec-once = hypridle
exec-once = hyprsunset
exec-once = hyprpm reload -n

# ############ Secret Portal: KDE Wallet #############
# REQUIRED; initiate kwallet pam
exec-once = /usr/lib/pam_kwallet_init
# REQUIRED; REQUIRED USING QDBUS6 otherwise it will pop up password modal on startup; open kwallet on login
exec-once = qdbus6 org.kde.kwalletd6 /modules/kwalletd6 org.kde.KWallet.open kdewallet 0 login

exec-once = qs -c noctalia-shell -d

# ==================
# INPUT CONFIG
# ==================
input {
    kb_layout = us
    kb_options = altwin:swap_lalt_lwin
    numlock_by_default = true
    touchpad {
        natural_scroll = true
    }
}

# ==================
# GENERAL LAYOUT 
# ==================
general {
    gaps_in = 3
    gaps_out = 6
    border_size = 0

    layout = dwindle
}

# ==================
# DECORATION
# ==================
decoration {
    rounding = 7

    active_opacity = 1.0
    inactive_opacity = 0.98

    shadow {
        enabled = true
        range = 30
        render_power = 5
        offset = 0 5
        color = rgba(00000070)
    }

    blur {
      enabled = true
      size = 5
      passes = 5
      vibrancy = 0.1696
    }
}

# ==================
# ANIMATIONS
# ==================
animations {
    enabled = true

    animation = windowsIn, 1, 3, default
    animation = windowsOut, 1, 3, default
    animation = workspaces, 1, 5, default
    animation = windowsMove, 1, 4, default
    animation = fade, 1, 3, default
    animation = border, 1, 3, default
}

# ==================
# LAYOUTS
# ==================
dwindle {
    preserve_split = true
}

master {
    mfact = 0.5
}

# ==================
# MISC
# ==================
misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true
    vrr = 1
}

# ==================
# WINDOW RULES
# ==================

windowrule = float on, match:class ^(xdg-desktop-portal)$

windowrule = match:class org.freedesktop.impl.portal.desktop.kde, float on
windowrule = match:class org.freedesktop.impl.portal.desktop.kde, size (monitor_w*.60) (monitor_h*.65)

windowrule = float on, match:class ^(firefox)$, match:title ^(Picture-in-Picture)$

# DMS windows floating by default
# ! Hyprland doesn't size these windows correctly so disabling by default here
# windowrule = float on, match:class ^(org.quickshell)$

layerrule = no_anim on, match:namespace ^(quickshell)$

# ==================
# BASICS KEYBINDS
# ==================

bind = SUPER, Q, killactive
bind = SUPER, 1, workspace, 1
bind = SUPER, 2, workspace, 2
bind = SUPER, 3, workspace, 3
bind = SUPER, 4, workspace, 4
bind = SUPER, 5, workspace, 5
bind = SUPER, 6, workspace, 6
bind = SUPER, 7, workspace, 7
bind = SUPER, 8, workspace, 8
bind = SUPER, 9, workspace, 9
bind = SUPER, 0, workspace, 10
bind = SUPER_SHIFT, 1, movetoworkspace, 1
bind = SUPER_SHIFT, 2, movetoworkspace, 2
bind = SUPER_SHIFT, 3, movetoworkspace, 3
bind = SUPER_SHIFT, 4, movetoworkspace, 4
bind = SUPER_SHIFT, 5, movetoworkspace, 5
bind = SUPER_SHIFT, 6, movetoworkspace, 6
bind = SUPER_SHIFT, 7, movetoworkspace, 7
bind = SUPER_SHIFT, 8, movetoworkspace, 8
bind = SUPER_SHIFT, 9, movetoworkspace, 9
bind = SUPER_SHIFT, 0, movetoworkspace, 10

bind = SUPER, F, fullscreen, 1
bind = SUPER_ALT, F, togglefloating, 

bind = SUPER, left, movefocus, l
bind = SUPER, down, movefocus, d
bind = SUPER, up, movefocus, u
bind = SUPER, right, movefocus, r
bind = SUPER, H, movefocus, l
bind = SUPER, J, movefocus, d
bind = SUPER, K, movefocus, u
bind = SUPER, L, movefocus, r

bind = SUPER_SHIFT, left, swapwindow, l
bind = SUPER_SHIFT, right, swapwindow, r
bind = SUPER_SHIFT, up, swapwindow, u
bind = SUPER_SHIFT, down, swapwindow, d
bind = SUPER_SHIFT, H, swapwindow, l
bind = SUPER_SHIFT, L, swapwindow, r
bind = SUPER_SHIFT, K, swapwindow, u
bind = SUPER_SHIFT, J, swapwindow, d

bind = SUPER CTRL, left, focusmonitor, l
bind = SUPER CTRL, right, focusmonitor, r
bind = SUPER CTRL, H, focusmonitor, l
bind = SUPER CTRL, J, focusmonitor, d
bind = SUPER CTRL, K, focusmonitor, u
bind = SUPER CTRL, L, focusmonitor, r

bind = SUPER SHIFT CTRL, left, movewindow, mon:l
bind = SUPER SHIFT CTRL, down, movewindow, mon:d
bind = SUPER SHIFT CTRL, up, movewindow, mon:u
bind = SUPER SHIFT CTRL, right, movewindow, mon:r
bind = SUPER SHIFT CTRL, H, movewindow, mon:l
bind = SUPER SHIFT CTRL, J, movewindow, mon:d
bind = SUPER SHIFT CTRL, K, movewindow, mon:u
bind = SUPER SHIFT CTRL, L, movewindow, mon:r

bind = SUPER, Page_Down, workspace, e+1
bind = SUPER, Page_Up, workspace, e-1
bind = SUPER, U, workspace, e+1
bind = SUPER, I, workspace, e-1
bind = SUPER SHIFT, down, movetoworkspace, e+1
bind = SUPER SHIFT, up, movetoworkspace, e-1
bind = SUPER SHIFT, U, movetoworkspace, e+1
bind = SUPER SHIFT, I, movetoworkspace, e-1

gesture = 3, horizontal, workspace

bind = SUPER, RETURN, exec, $TERM
bind = SUPER, B, exec, ~/.config/hypr/scripts/open-default-browser.sh
bind = SUPER, E, exec, ~/.config/hypr/scripts/open-default-file-manager.sh

bindm = SUPER, mouse:272, movewindow
bindm = SUPER_CTRL, mouse:272, resizewindow

bind = SUPER_SHIFT, S, exec, grim -g "$(slurp)" -t ppm - | satty --filename - --output-filename ~/Pictures/Screenshots/Screenshot-$(date '+%Y%m%d-%H:%M:%S').png 

$ipc = qs -c noctalia-shell ipc call

# Core binds
bind = SUPER, SPACE, exec, $ipc launcher toggle
bind = SUPER, S, exec, $ipc controlCenter toggle
bind = SUPER, comma, exec, $ipc settings toggle

# Media keys
bindel = , XF86AudioRaiseVolume, exec, $ipc volume increase
bindel = , XF86AudioLowerVolume, exec, $ipc volume decrease
bindl = , XF86AudioMute, exec, $ipc volume muteOutput
bindel = , XF86MonBrightnessUp, exec, $ipc brightness increase
bindel = , XF86MonBrightnessDown, exec, $ipc brightness decrease

bind = SUPER, Escape, exec, $ipc sessionMenu toggle

bind = SUPER, M, exec, $ipc systemMonitor toggle

bind = SUPER, Tab, exec, $ipc bar toggle

bind = SUPER, W, exec, $ipc wallpaper random

bind = SUPER_SHIFT, W, exec, $ipc wallpaper toggle

bind = SUPER, V, exec, $ipc launcher clipboard

bind = SUPER, N, exec, $ipc notifications toggleHistory
bind = SUPER_CTRL, N, exec, $ipc notifications toggleDND

layerrule {
  name = noctalia
  match:namespace = noctalia-background-.*$
  ignore_alpha = 0.5
  blur = true
  blur_popups = true
}

# ==================
# PLUGINS
# ==================

source = ../conf/plugins/hyprscrolling.conf

# ############ XWayland #############
# Handle xwayland way better than Hyprland's native implementation
source = ../conf/plugins/xwayland-satellite.conf

# ==================
# IMPORTS
# ==================

source = ../conf/windowrules.conf

source = ../noctalia/noctalia-colors.conf

exec-once = udiskie &
exec-once = warp-taskbar &
